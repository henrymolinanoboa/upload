DROP VIEW sch_sms.notificaciones_vw;
CREATE VIEW sch_sms.notificaciones_vw AS
SELECT
    t1.id,
    t1.usuario_creacion,
    t1.fecha_creacion,
    t1.usuario_actualizacion,
    t1.fecha_actualizacion,
    t1.usuario_reporta_id,
    t2.username usuario_reporta_username,
    t2.nombre_completo usuario_reporta_nombre_completo, 
    t1.no_acta,
    t1.nombre_evento,
    t1.fecha_hora,
    t1.lugar,
    t1.descripcion,
    t1.matricula_aeronave,
    t1.conocer_resultados,
    t1.sugerencias,
    t1.nivel_criticidad_catalogo_id,
    t3.codigo nivel_criticidad_catalogo_codigo,
    t3.nombre nivel_criticidad_catalogo_nombre,
    t1.tipo_notificacion_catalogo_id,
    t4.codigo tipo_notificacion_catalogo_codigo,
    t4.nombre tipo_notificacion_catalogo_nombre,
    t1.companias_otros,
    t1.nombres,
    t1.empresa,
    t1.cargo,
    t1.correo_electronico,
    t1.codigo_tipo_notificacion,
    CASE
       WHEN  t1.codigo_tipo_notificacion='OI' THEN 'OBLIGATORIO INTERNO'
       WHEN  t1.codigo_tipo_notificacion='VI' THEN 'VOLUNTARIO INTERNO'
       WHEN  t1.codigo_tipo_notificacion='VE' THEN 'VOLUNTARIO EXTERNO'
       ELSE '***'
    END as nombre_tipo_notificacion,
    t1.estado_id,
    t5.codigo estado_codigo,
    t5.nombre estado_nombre,
    t1.numero,
    t1.tipo_evento_catalogo_id,
    t6.codigo tipo_evento_catalogo_codigo,
    t6.nombre tipo_evento_catalogo_nombre,
    t1.apellidos,
    t1.apellidos_nombres,
    t1.tipo_identificacion,
    t1.numero_identificacion,
    t1.codigo_nivel_confidencialidad,
    t1.nombre_nivel_confidencialidad,
    t1.incidente_accidente_catalogo_id,
    t7.codigo incidente_accidente_catalogo_codigo,
    t7.nombre incidente_accidente_catalogo_nombre,
    t1.activo_alerta_pea,
    t1.lugar_catalogo_id,
    t8.codigo lugar_catalogo_codigo,
    t8.nombre lugar_catalogo_nombre,
    t1.nombre_evento_catalogo_id,
    t9.codigo nombre_evento_catalogo_codigo,
    t9.nombre nombre_evento_catalogo_nombre,
    t1.usuario_asignado,
    t1.accidente_incidente,
    t1.companias,
    t1.criticidad,
    t1.fecha_consentimiento,
    t1.mensaje_consentimiento,
    t1.usuario_consentimiento,
    t1.diff,
    t1.resumen,
    t1.acta_no_conformidad,
    t1.compartir_reporte_ehs,
    t1.usuario_reporta,
    t1.nivel_confidencialidad
    COALESCE(TO_CHAR(t1.fecha_hora, 'DD-MM-YYYY'),'') ||
    COALESCE(t1.numero,'') ||
    COALESCE(t1.codigo_tipo_notificacion,'') ||
    COALESCE(TO_CHAR(t1.fecha_creacion, 'DD-MM-YYYY'),'') ||
    COALESCE(t8.nombre,'') ||
    COALESCE(t9.nombre,'') ||
    COALESCE(t1.descripcion,'') ||
    COALESCE(t7.nombre,'') ||
    COALESCE(t1.companias,'') ||
    COALESCE(t5.nombre,'')  ||
    COALESCE(t1.acta_no_conformidad,'')  ||
    COALESCE(t1.usuario_reporta,'')  ||
    COALESCE(t1.nivel_confidencialidad,'')  ||
    COALESCE(t1.usuario_asignado,'')  ||
        CASE
       WHEN  t1.codigo_tipo_notificacion='OI' THEN 'OBLIGATORIO INTERNO'
       WHEN  t1.codigo_tipo_notificacion='VI' THEN 'VOLUNTARIO INTERNO'
       WHEN  t1.codigo_tipo_notificacion='VE' THEN 'VOLUNTARIO EXTERNO'
       ELSE '***'
    END as filter
FROM
    sch_sms.notificaciones t1
LEFT JOIN 
    sch_usuarios.usuarios t2 ON t1.usuario_reporta_id = t2.id
LEFT JOIN 
   sch_catalogos.catalogos t3 ON t1.nivel_criticidad_catalogo_id = t3.id
LEFT JOIN 
   sch_catalogos.catalogos t4 ON t1.tipo_notificacion_catalogo_id = t4.id   
LEFT JOIN 
   sch_sms.estados t5 ON t1.estado_id = t5.id
LEFT JOIN 
   sch_catalogos.catalogos t6 ON t1.tipo_evento_catalogo_id = t6.id   
LEFT JOIN 
   sch_catalogos.catalogos t7 ON t1.incidente_accidente_catalogo_id = t7.id      

LEFT JOIN 
   sch_catalogos.catalogos t8 ON t1.lugar_catalogo_id = t8.id      
LEFT JOIN 
   sch_catalogos.catalogos t9 ON t1.nombre_evento_catalogo_id = t9.id      
WHERE 
    t1.vigente=true
